<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tính khoảng thời gian bằng JS</title>
    <style>
        span {border: solid 1px #ACACAC; padding: 2px; margin-right: 5px;}
    </style>
    <script language="javascript">
        var hours = null;
        var minutes = null;
        var seconds = null;
        var timeout = null;
        function setTimeExam(minutes){
            var currentdate = new Date(); 
            var newDateObj = new Date();
            newDateObj.setTime(currentdate.getTime() + (minutes * 60 * 1000));

            let mini = currentdate.getMinutes() < 10 ? "0" + currentdate.getMinutes() : currentdate.getMinutes()
            let start = currentdate.getHours() + ":" + mini


            let mini2 = newDateObj.getMinutes() < 10 ? "0" + newDateObj.getMinutes() : newDateObj.getMinutes()
            let end = newDateObj.getHours() + ":" + mini2
            return {
                start, end
            }
        }

        
        function calculateTimeDifference(time) {

            // Lấy giá trị nhập vàoststartTime
            let timeExam = setTimeExam(time);
            var startTime = timeExam.start;
            var endTime = timeExam.end;
        

            // Tính khoảng thời gian ở đơn vị giây
            var startTimeInSeconds = parseTimeToSeconds(startTime);
            var endTimeInSeconds = parseTimeToSeconds(endTime);

            var timeDifferenceInSeconds = endTimeInSeconds - startTimeInSeconds;

            // Chuyển đổi khoảng thời gian sang giờ, phút và giây
            var timeParts = splitTime(timeDifferenceInSeconds);

            hours = timeParts.hours;
            minutes = timeParts.minutes;
            seconds = timeParts.seconds;

            // Hiển thị kết quả và cập nhật giá trị cho đếm ngược
            updateResult();

            // Bắt đầu đếm ngược
            updateClock();
        }

        function parseTimeToSeconds(timeString) {
            var timeArray = timeString.split(":");
            return parseInt(timeArray[0]) * 3600 + parseInt(timeArray[1]) * 60;
        }

        function splitTime(totalSeconds) {
            var hours = Math.floor(totalSeconds / 3600);
            var remainingSeconds = totalSeconds % 3600;
            var minutes = Math.floor(remainingSeconds / 60);
            var seconds = remainingSeconds % 60;

            return {
                hours: hours,
                minutes: minutes,
                seconds: seconds
            };
        }

        function formatTimeUnit(unit) {
            return unit < 10 ? '0' + unit : unit;
        }

        function updateResult() {
            // Display the initial time
            document.getElementById('total_time').innerText = formatTimeUnit(hours) + ':' + formatTimeUnit(minutes) + ':' + formatTimeUnit(seconds);
        }

        function updateClock() {
            // Kiểm tra xem đếm ngược đã đạt đến không
            if (hours === 0 && minutes === 0 && seconds === 0) {
                clearTimeout(timeout);
                alert('Hết giờ');
            } else {
                // Cập nhật giá trị đếm ngược
                if (seconds > 0) {
                    seconds--;
                } else {
                    if (minutes > 0) {
                        minutes--;
                        seconds = 59;
                    } else {
                        if (hours > 0) {
                            hours--;
                            minutes = 59;
                            seconds = 59;
                        }
                    }
                }

                // Hiển thị giờ, phút, giây còn lại
                document.getElementById('total_time').innerText = formatTimeUnit(hours) + ':' + formatTimeUnit(minutes) + ':' + formatTimeUnit(seconds);

                // Tiếp tục đếm ngược
                timeout = setTimeout(updateClock, 1000);
            }
        }


        setTimeout(function() {
            calculateTimeDifference(50)
        }, 1000)
    </script>
</head>
<body>
   

    <div>
        <span id="total_time"></span>
    </div>
</body>
</html>
